<!DOCTYPE html>
<html>
<head>
<title>GM</title>
<meta name="viewport" content="initial-scale=1.0">
<meta charset="utf-8">
<meta name="theme-color" content="#3F51B5">
<link rel="icon" sizes="32x32" href="app/icons/icon-32x32.png">
<link rel="icon" sizes="192x192" href="app/icons/icon-192x192.png">
<link rel="icon" sizes="512x512" href="app/icons/icon-512x512.png">
<link rel="apple-touch-icon" sizes="512x512" href="app/icons/icon-512x512.png">
<link rel="apple-touch-icon-precomposed" sizes="512x512" href="app/icons/icon-512x512.png">
<link rel="manifest" href="manifest.json">
<style>
html, body {
    height: 100%;
    margin: 0;
    padding: 0;
}
#map {
    height: 100%;
}
#dialog {
    background-color: #FFFFFF;
    color: #000000;
    font-family: arial, sans-serif;
    font-size: 12px;
    font-weight: bold;
    padding: 5px;
    position: absolute;
    left: 0px;
    top: 0px;
    z-index: 20000;
}
#dialog a {
    color: #000000;
}
</style>
</head>
<body>
<div id="dialog">
    <p><a id="locateMe" href="#">Locate me</a></p>
    <p><a id="reload" href="#">Reload</a></p>
</div>
<div id="map"></div>
<script>
if('serviceWorker' in navigator && window.location.protocol === 'https:') {
    navigator.serviceWorker.register('serviceworker.js').then(function() {
    }).catch(function() {
    });

    /*navigator.serviceWorker.ready.then(function(ServiceWorkerRegistration) {
        ServiceWorkerRegistration.unregister().then(function() {
        });
    });*/
}
var map;
var hotel = {lat: 22.5436152, lng: 114.1229518};
var office = {lat: 22.5389099, lng: 114.1153223};
var dinner = {lat: 22.5369349, lng: 114.1195043};

var markerMe = false;

function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
        center: hotel,
        fullscreenControl: false,
        mapTypeControl: false,
        streetViewControl: false,
        zoom: 18
    });
    map.addListener('click', function(e) {
        infowindowHotel.close();
        infowindowOffice.close();
        infowindowDinner.close();
    });

    var infowindowHotel = new google.maps.InfoWindow({
        content: '2103 Shennan East Road, Luohu District'
    });
    var markerHotel = new google.maps.Marker({
        position: hotel,
        map: map
    });
    markerHotel.addListener('click', function() {
        infowindowHotel.open(map, markerHotel);
    });

    var infowindowOffice = new google.maps.InfoWindow({
        content: '1199 Heping Road, Luohu District'
    });
    var markerOffice = new google.maps.Marker({
        position: office,
        map: map
    });
    markerOffice.addListener('click', function() {
        infowindowOffice.open(map, markerOffice);
    });

    var infowindowDinner = new google.maps.InfoWindow({
        content: '2002 Renmin South Road, Luohu District'
    });
    var markerDinner = new google.maps.Marker({
        position: dinner,
        map: map
    });
    markerDinner.addListener('click', function() {
        infowindowDinner.open(map, markerDinner);
    });
}
function locateMe() {
    if(navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function(position) {
                latlngMe = {lat: position.coords.latitude, lng: position.coords.longitude};

                if(!markerMe) {
                    markerMe = new google.maps.Marker({
                        position: latlngMe,
                        map: map
                    });
                } else {
                    markerMe.setPosition(latlngMe);
                }

                map.setCenter(latlngMe);

                //ui_emptymessage();
            },
            function(error) {
                /*if(error.code == 1) {
                    ui_setmessage('<p>Geolocation: permission denied</p>');
                } else if(error.code == 2) {
                    ui_setmessage('<p>Geolocation: position unavailable</p>');
                } else if(error.code == 3) {
                    ui_setmessage('<p>Geolocation: timeout</p>');
                } else {
                    ui_setmessage('<p>Geolocation: unknown error</p>');
                }*/
            },
            {'enableHighAccuracy': true, 'timeout': 30000}
        );
    }
}
document.getElementById('locateMe').addEventListener('click', function() {
    locateMe();
});
document.getElementById('reload').addEventListener('click', function() {
    document.location.reload(true);
});
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBXH0ZaJbsGQkcIGj_y4MgTu3uRfixZ-D4&callback=initMap" async defer></script>
</body>
</html>
